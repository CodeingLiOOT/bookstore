!function(F,G){"use strict";var n="ht",D=n+".layout.",M=F[n]||module.parent.exports.ht,O=M.List,B=M.DataModel,v=M.Node,e=M.Edge,z=M.Group,q=Math,p=q.sqrt,J=q.random,u=q.max,R=q.min,s=function(b){return b*b};M.Default.getInternal().addMSMap({ms_force:function(m){m._interval=50,m._stepCount=10,m._motionLimit=.01,m._edgeRepulsion=.65,m._nodeRepulsion=.65,m._damper=1,m._maxMotion=0,m._motionRatio=0,m.init=function(G){var Z=this;G instanceof B?Z.dm=G:Z.gv=G,Z._nodeMap={},Z._nodes=new O,Z._edges=new O},m.start=function(){var o=this,i=o.gv;if(!o._timer){var G=o.cdm=i?i.dm():o.dm;G.mm(o.handleDataModelChange,o),G.md(o.handleDataPropertyChange,o),i&&i.mp(o.handleGV,o),G.each(function(y){if(o.isVisible(y)&&o.isLayoutable(y)&&y instanceof v)if(o instanceof j){var h=y.p3();y.p3([h[0]+J(),h[1]+J(),h[2]+J()])}else h=y.p(),y.p(h.x+J(),h.y+J())}),o._timer=setInterval(function(){o.relax()},o._interval),o._damper=1}},m.stop=function(){var e=this;e._timer&&(e.cdm.umm(e.handleDataModelChange,e),e.cdm.umd(e.handleDataPropertyChange,e),e.gv&&e.gv.ump(e.handleGV,e),clearInterval(e._timer),delete e._timer,delete e.cdm)},m.handleGV=function(N){var F=this;if("dataModel"===N.property){var Q=N.oldValue,q=N.newValue;Q&&(Q.umm(F.handleDataModelChange,F),Q.umd(F.handleDataPropertyChange,F)),this.cdm=q,q.mm(F.handleDataModelChange,F),q.md(F.handleDataPropertyChange,F)}},m.relax=function(){var S=this;if(!(S._damper<.1&&S._maxMotion<S._motionLimit)){this.cdm.each(function(H){S.isVisible(H)&&(H instanceof e?S.addEdge(H):H instanceof v&&S.addNode(H))});for(var U,J,k=0,s=S._edges,o=S._nodes,E=o.size();k<S._stepCount;k++){for(s.each(S.relaxEdge,S),U=0;E>U;U++)for(J=0;E>J;J++)S.relaxNode(o.get(U),o.get(J));S.moveNode()}S._isAdjusting=1,o.each(function(m){m.fix||(m.p?m.v.p3(m.p):m.v.p(m.x,m.y))}),delete S._isAdjusting,S._nodeMap={},o.clear(),s.clear(),S.onRelaxed()}},m.onRelaxed=function(){},m.isRunning=function(){return!!this._timer},m.isVisible=function(A){return A.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(A):!0},m.isLayoutable=function(q){if(q.s("layoutable")===!1)return!1;if(q instanceof z)return!1;var n=this;return n.gv?n.gv.isMovable(q)&&!n.gv.isSelected(q):!(n.cdm||n.dm).sm().co(q)},m.getNodeRepulsion=function(){return this._nodeRepulsion},m.setNodeRepulsion=function(C){this._nodeRepulsion=C,this._damper=1},m.getEdgeRepulsion=function(){return this._edgeRepulsion},m.setEdgeRepulsion=function(C){this._edgeRepulsion=C,this._damper=1},m.getStepCount=function(){return this._stepCount},m.setStepCount=function(P){this._stepCount=P,this._damper=1},m.getInterval=function(){return this._interval},m.setInterval=function(c){var A=this;A._interval!==c&&(A._interval=c,A._timer&&(clearInterval(A._timer),A._timer=setInterval(function(){A.relax()},c)))},m.handleDataPropertyChange=function(m){!this._isAdjusting&&this.isVisible(m.data)&&(this._damper=1)},m.handleDataModelChange=function(){this._damper=1},m.damp=function(){var l=this._maxMotion,q=this._damper;this._motionRatio<=.001&&((.2>l||l>1&&.9>q)&&q>.01?this._damper-=.01:.4>l&&q>.003?this._damper-=.003:q>1e-4&&(this._damper-=1e-4)),l<this._motionLimit&&(this._damper=0)}}}),M.layout.ForceLayout=function(V){this.init(V)},M.Default.def(D+"ForceLayout",G,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(g){this._limitBounds=g,this._damper=1},getNodeSize:function(e){var h=this.gv;return h&&h.getDataUIBounds?h.getDataUIBounds(e):e.getRect()},addNode:function(L){var e=this,d=e._nodeMap[L._id];if(d)return d;var O=L.p();d={v:L,x:O.x,y:O.y,dx:0,dy:0,fix:!e.isLayoutable(L),s:e.getNodeSize(L)};var T=d.s,M=p(s(T.width)+s(T.height))*e._nodeRepulsion;return d.r=1>M?100:M,e._nodeMap[L._id]=d,e._nodes.add(d),d},addEdge:function(v){if(v._40I&&v._41I){var z=this,D=z.addNode(v._40I),B=z.addNode(v._41I),L={s:D,t:B};B=B.s,D=D.s;var t=B.width+D.width,d=B.height+D.height;L.length=p(t*t+d*d)*z._edgeRepulsion,L.length<=0&&(L.length=100),z._edges.add(L)}},relaxEdge:function(Q){var i=Q.t,k=Q.s,V=i.x-k.x,o=i.y-k.y,f=p(V*V+o*o),u=100*Q.length,l=.25*V/u*f,B=.25*o/u*f;i.dx=i.dx-l,i.dy=i.dy-B,k.dx=k.dx+l,k.dy=k.dy+B},relaxNode:function(P,p){if(P!==p){var D=0,t=0,u=P.x-p.x,G=P.y-p.y,o=u*u+G*G;0===o?(D=J(),t=J()):36e4>o&&(D=u/o,t=G/o);var l=P.r*p.r/400;D*=l,t*=l,P.dx+=D,P.dy+=t,p.dx-=D,p.dy-=t}},moveNode:function(){var l=this,o=l._limitBounds,f=l._maxMotion,I=0,S=l._damper;l._nodes.each(function(e){if(!e.fix){var a=e.dx*S,A=e.dy*S;if(e.dx=a/2,e.dy=A/2,I=u(p(a*a+A*A),I),e.x+=u(-40,R(40,a)),e.y+=u(-40,R(40,A)),o){e.x<o.x&&(e.x=o.x,l.adjust(1,0)),e.y<o.y&&(e.y=o.y,l.adjust(0,1));var z=e.s;e.x+z.width>o.x+o.width&&(e.x=o.x+o.width-z.width,l.adjust(-1,0)),e.y+z.height>o.y+o.height&&(e.y=o.y+o.height-z.height,l.adjust(0,-1))}}}),l._maxMotion=I,l._motionRatio=I>0?f/I-1:0,l.damp()},adjust:function(z,b){var y=this._limitBounds;this._nodes.each(function($){z>0?(!y||$.x+$.s.width+z<y.x+y.width)&&($.x+=z):(!y||$.x+z>y.x)&&($.x+=z),b>0?(!y||$.y+$.s.height+b<y.y+y.height)&&($.y+=b):(!y||$.y+b>y.y)&&($.y+=b)})}});var j=M.layout.Force3dLayout=function(s){this.init(s)};M.Default.def(D+"Force3dLayout",G,{ms_force:1,getNodeSize3d:function(o){return o.s3()},addNode:function(c){var t=this,o=t._nodeMap[c._id];if(o)return o;o={v:c,p:c.p3(),d:[0,0,0],fix:!t.isLayoutable(c),s:t.getNodeSize3d(c)};var Y=o.s,j=M.Default.getDistance(Y)*t._nodeRepulsion;return o.r=1>j?100:j,t._nodeMap[c._id]=o,t._nodes.add(o),o},addEdge:function(L){if(L._40I&&L._41I){var R=this,M=R.addNode(L._40I),Z=R.addNode(L._41I),D={s:M,t:Z};Z=Z.s,M=M.s,D.length=p(s(Z[0]+M[0])+s(Z[1]+M[1])+s(Z[2]+M[2]))*R._edgeRepulsion,D.length<=0&&(D.length=100),R._edges.add(D)}},relaxEdge:function(N){var b=N.t.p,C=N.s.p,o=N.t.d,R=N.s.d,A=b[0]-C[0],n=b[1]-C[1],k=b[2]-C[2],l=p(A*A+n*n+k*k),a=100*N.length,e=.25*A/a*l,q=.25*n/a*l,L=.25*k/a*l;o[0]-=e,o[1]-=q,o[2]-=L,R[0]+=e,R[1]+=q,R[2]+=L},relaxNode:function(u,w){if(u!==w){var A=u.p,e=w.p,N=0,f=0,s=0,E=A[0]-e[0],b=A[1]-e[1],W=A[2]-e[2],r=E*E+b*b+W*W;0===r?(N=J(),f=J(),s=J()):216e6>r&&(N=E/r,f=b/r,s=W/r);var T=u.r*w.r/400,m=u.d,y=w.d;N*=T,f*=T,s*=T,m[0]+=N,m[1]+=f,m[2]+=s,y[0]-=N,y[1]-=f,y[2]-=s}},moveNode:function(){var l=this,O=l._maxMotion,L=0,n=l._damper;l._nodes.each(function(j){if(!j.fix){var m=j.p,G=j.d,P=G[0]*n,I=G[1]*n,F=G[2]*n;G[0]=P/2,G[1]=I/2,G[2]=F/2,L=u(p(P*P+I*I+F*F),L),m[0]+=u(-40,R(40,P)),m[1]+=u(-40,R(40,I)),m[2]+=u(-40,R(40,F))}}),l._maxMotion=L,l._motionRatio=L>0?O/L-1:0,l.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);