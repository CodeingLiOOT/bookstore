!function(k,o){"use strict";var K=ht.AlarmSeverity=function(g,X,M,G,l){this.value=g,this.name=X,this.nickName=M,this.color=G,this.displayName=l};ht.Default.def("ht.AlarmSeverity",o,{toString:function(){return this.displayName||this.name}}),function(){K.severities=new ht.List,K._vm={},K._nm={},K._cp=function(S,d){if(S&&d){var N=S.value-d.value;return N>0?1:0>N?-1:0}return S&&!d?1:!S&&d?-1:0},K.each=function(t,i){K.severities.each(t,i)},K.getSortFunction=function(){return K._cp},K.setSortFunction=function(U){K._cp=U,K.severities.sort(U)},K.add=function(I,o,P,b,w){var _=new K(I,o,P,b,w);return K._vm[I]=_,K._nm[o]=_,K.severities.add(_),K.severities.sort(K._cp),_},K.remove=function(n){var L=K._nm[n];return L&&(delete K._nm[n],delete K._vm[L.value],K.severities.remove(L)),L},K.CRITICAL=K.add(500,"Critical","C","#FF0000"),K.MAJOR=K.add(400,"Major","M","#FFA000"),K.MINOR=K.add(300,"Minor","m","#FFFF00"),K.WARNING=K.add(200,"Warning","W","#00FFFF"),K.INDETERMINATE=K.add(100,"Indeterminate","N","#C800FF"),K.CLEARED=K.add(0,"Cleared","R","#00FF00"),K.isClearedAlarmSeverity=function(C){return C?0===C.value:!1},K.getByName=function(b){return K._nm[b]},K.getByValue=function(n){return K._vm[n]},K.clear=function(){K.severities.clear(),K._vm={},K._nm={}},K.compare=function(U,t){return K._cp(U,t)}}();var u=ht.AlarmState=function(K){this._d=K,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",o,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var H=null;for(var O in this._am)O=K.getByName(O),K.isClearedAlarmSeverity(O)||0!==this.getAcknowledgedAlarmCount(O)&&(H=H?K.compare(H,O)>0?H:O:O);this._haa=H},_c2:function(){var l=null;for(var L in this._nm)L=K.getByName(L),K.isClearedAlarmSeverity(L)||0!==this.getNewAlarmCount(L)&&(l=l?K.compare(l,L)>0?l:L:L);this._hna=l},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var m in this._nm)if(m=K.getByName(m),!K.isClearedAlarmSeverity(m)&&0!==this.getNewAlarmCount(m)&&K.compare(this._hna,m)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var k=this._haa,E=this._hna,d=this._ps;this._hoa=k,K.compare(E,this._hoa)>0&&(this._hoa=E),K.compare(d,this._hoa)>0&&(this._hoa=d)},_c5:function(){var b=this._haa,w=this._hna;this._hta=b,K.compare(w,this._hta)>0&&(this._hta=w)},increaseAcknowledgedAlarm:function(P,n){if(0!==n){n=n||1;var x=this._am[P.name]||0;x+=n,this._am[P.name]=x,this._f()}},increaseNewAlarm:function(T,R){if(0!==R){R=R||1;var U=this._nm[T.name]||0;U+=R,this._nm[T.name]=U,this._f()}},decreaseAcknowledgedAlarm:function(W,t){if(0!==t){t||(t=1);var V=this._am[W.name]||0;if(V-=t,0>V)throw"Alarm count can not be negative";this._am[W.name]=V,this._f()}},decreaseNewAlarm:function(v,t){if(0!==t){t||(t=1);var G=this._nm[v.name]||0;if(G-=t,0>G)throw"Alarm count can not be negative";this._nm[v.name]=G,this._f()}},acknowledgeAlarm:function(o){this.decreaseNewAlarm(o,1),this.increaseAcknowledgedAlarm(o,1)},acknowledgeAllAlarms:function(o){if(o){var X=this.getNewAlarmCount(o);this.decreaseNewAlarm(o,X),this.increaseAcknowledgedAlarm(o,X)}else for(var Q in this._nm)this.acknowledgeAllAlarms(K.getByName(Q))},_c6:function(){this._aac=0;for(var N in this._am)N=K.getByName(N),this._aac+=this.getAcknowledgedAlarmCount(N)},getAcknowledgedAlarmCount:function(o){return o?this._am[o.name]||0:this._aac},getAlarmCount:function(C){return this.getAcknowledgedAlarmCount(C)+this.getNewAlarmCount(C)},_c7:function(){this._nac=0;for(var J in this._nm)this._nac+=this.getNewAlarmCount(K.getByName(J))},getNewAlarmCount:function(Z){return Z?this._nm[Z.name]||0:this._nac},setNewAlarmCount:function(S,y){this._nm[S.name]=y,this._f()},removeAllNewAlarms:function(G){G?delete this._nm[G]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(h,v){this._am[h.name]=v,this._f()},removeAllAcknowledgedAlarms:function(C){C?delete this._am[C.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(I){if(this._ep||(I=null),this._ps!==I){var z=this._ps;this._ps=I,this._f(),this._d.fp("propagateSeverity",z,I)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(M){var z=this._ep;this._ep=M,this._d.fp("enablePropagation",z,M)&&(M||this.setPropagateSeverity(null))}});var w=ht.AlarmStatePropagator=function(e){this._dataModel=e,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",o,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(V){this._enable!==V&&(this._enable=V,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(m){this.propagate(m)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(d){d.data&&this.propagate(d.data)},handleDataPropertyChange:function(o){if("alarmState"===o.property||"enablePropagation"===o.property)this.propagate(o.data);else if("parent"===o.property){var t=o.oldValue;t&&this.propagate(t),this.propagate(o.data)}},propagate:function(i){i&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(i),this._isPropagating=!1)},propagateToTop:function(p){for(this.propagateToParent(null,p);p&&p.getParent();)this.propagateToParent(p,p.getParent()),p=p.getParent()},propagateToParent:function(o,$){var u=null;$.getChildren().each(function(m){var M=m.getAlarmState().getHighestOverallAlarmSeverity();K.compare(M,u)>0&&(u=M)}),$.getAlarmState().setPropagateSeverity(u)}}),ht.AlarmStateStatistics=function(s){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(s)},ht.Default.def("ht.AlarmStateStatistics",o,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(K){var E=this._dataModel;E!==K&&(E&&(E.umd(this.handleDataPropertyChange,this),E.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=K,this.reset(),K.md(this.handleDataPropertyChange,this),K.mm(this.handleDataModelChange,this),this.fp("dataModel",E,K))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(T){"alarmState"===T.property&&(this.increase(T.data),this.fireAlarmStateChange())},handleDataModelChange:function(s){"add"===s.kind?(this.increase(s.data),this.fireAlarmStateChange()):"remove"===s.kind?(this.decrease(s.data),this.fireAlarmStateChange()):"clear"===s.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,K.each(function(u){var k=this.getSumInfo(u);this.sumAcked+=k.ackedCount,this.sumNew+=k.newCount,this.sumTotal+=k.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(L){if(!L)return this.sumNew;var Y=this.getSumInfo(L);return Y.newCount},getAcknowledgedAlarmCount:function(I){if(!I)return this.sumAcked;var A=this.getSumInfo(I);return A.ackedCount},getTotalAlarmCount:function(T){if(!T)return this.sumTotal;var U=this.getSumInfo(T);return U.totalCount},getSumInfo:function(e){var a=this.severtiyMap[e.name];return a||(a={},a.newCount=0,a.ackedCount=0,a.totalCount=0,this.severtiyMap[e.name]=a),a},decrease:function(a){var A=this.dataMap[a.getId()];A&&(delete this.dataMap[a.getId()],K.each(function(Z){var $=A[Z.name],v=this.getSumInfo(Z);v.newCount=v.newCount-$.newCount,v.ackedCount=v.ackedCount-$.ackedCount,v.totalCount=v.totalCount-$.totalCount},this))},increase:function(j){if(this.decrease(j),!this._filterFunc||this._filterFunc(j)){var p={},D=j.getAlarmState();this.dataMap[j.getId()]=p,K.each(function(A){var J={};J.newCount=D.getNewAlarmCount(A),J.ackedCount=D.getAcknowledgedAlarmCount(A),J.totalCount=D.getAlarmCount(A),p[A.name]=J;var o=this.getSumInfo(A);o.newCount=o.newCount+J.newCount,o.ackedCount=o.ackedCount+J.ackedCount,o.totalCount=o.totalCount+J.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(y){var c=this._filterFunc;this._filterFunc=y,this.reset(),this.fp("filterFunc",c,y)},getFilterFunc:function(){return this._filterFunc}});var O=ht.Data.prototype;O.getAlarmState=function(){return this._alarmState||(this._alarmState=new u(this))},O=ht.DataModel.prototype,O.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},O.setEnableAlarmStatePropagator=function(M){M!=this.isEnableAlarmStatePropagator()&&(M?(this._alarmStatePropagator=new w(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},O=ht.graph.GraphView.prototype,O.getNote2=function(g){var N=g.getAlarmState().getHighestNewAlarmSeverity();if(N){var r=g.getAlarmState().getNewAlarmCount(N)+N.nickName;return g.getAlarmState().hasLessSevereNewAlarms()&&(r+="+"),r}return g.s("note2")},O.getNote2Background=function(q){var b=q.getAlarmState().getHighestNewAlarmSeverity();return b?b.color:q.s("note2.background")},O.getBodyColor=function(a){var e=a.getAlarmState().getHighestNativeAlarmSeverity();return e?e.color:a.s("body.color")},O.getBorderColor=function(T){var I=T.getAlarmState().getPropagateSeverity();return I?I.color:T.s("border.color")},O=ht.widget.TreeView.prototype,O.getBorderColor=function(U){var z=U.getAlarmState().getPropagateSeverity();return z?z.color:U.s("border.color")},O.getIcon=function(I){return I.getIcon()?"__alarmIcon__":null},O=ht.widget.TreeTableView.prototype,O.getBorderColor=function(V){var b=V.getAlarmState().getPropagateSeverity();return b?b.color:V.s("border.color")},O.getIcon=function(s){return s.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(d){return d.getIcon()}},color:{func:function(w){var J=w.getAlarmState().getHighestNativeAlarmSeverity();return J?J.color:w.s("body.color")}},rect:[0,0,16,16]}]});var C=ht.Style;C["note2.expanded"]=!0,C["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);