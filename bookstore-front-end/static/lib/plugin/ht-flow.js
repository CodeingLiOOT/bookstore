!function(m){"use strict";var g="ht",b=m[g],J=b.Default,I=Math,B=I.PI,_=2*B,y=I.sin,h=I.cos,C=I.atan2,n=I.sqrt,L=I.max,S=I.floor,T=(I.round,I.ceil),v=I.abs,a=b.Shape,O=b.Edge,Q=b.List,l=b.Style,q=b.graph,$=J.getInternal(),k=$.ui(),u=null,M="__segmentLengths",K="__lineTotalLength",s="__linePoints",Y="__distance0",p="flow.count",f="flow.step",i="flow.element.max",X="flow.element.count",E="flow.element.min",R="flow.element.space",F="flow.element.autorotate",r="flow.element.background",d="flow.element.shadow.max",c="flow.element.shadow.min",t="flow.element.shadow.begincolor",U="flow.element.shadow.endcolor",G="flow.element.shadow.visible",Z="flow.element.image",H="flow",D="prototype",V=q.GraphView[D],o=b.Data[D],N=k.DataUI[D],W=k.ShapeUI[D],x=k.EdgeUI[D],j=b.DataModel[D],P=W._80o,z=x._80o,A=j.prepareRemove,w=x._79o,e=W._79o,qr=V.setDataModel,So=function(y){return document.createElement(y)};V.calculatePointLength=function(h,G,x){var X=this,S=X.getDataUI(h);x==u&&(x=.1);var a=ph(S),W=[];if(a){for(var C=a.length,w=0;C>w;w++){var N=a[w];N._as&&(N=N._as);for(var y=N[0],I=1;I<N.length;I++)W.push([y,N[I]]),y=N[I]}for(var L=[],w=0;w<W.length;w++){var l=gb(W[w][0],W[w][1],G);L.push(l)}var Q=L.slice(0);Q.sort(function(B,r){return B.z>r.z?1:B.z<r.z?-1:0});var r=Q[0];if(r.z<x){for(var U=L.indexOf(r),P=0,w=0;U>=w;w++)P+=U>w?J.getDistance(W[w][0],W[w][1]):J.getDistance(W[w][0],r);return P}}},J.calculatePointLength=function($,N,h,y){y==u&&(y=.1);var a=ph(u,$,N),N=[];if(a){for(var _=a.length,d=0;_>d;d++){var Q=a[d];Q._as&&(Q=Q._as);for(var H=Q[0],s=1;s<Q.length;s++)N.push([H,Q[s]]),H=Q[s]}for(var M=[],d=0;d<N.length;d++){var m=gb(N[d][0],N[d][1],h);M.push(m)}var L=M.slice(0);L.sort(function(j,J){return j.z>J.z?1:j.z<J.z?-1:0});var V=L[0];if(V.z<y){for(var D=M.indexOf(V),A=0,d=0;D>=d;d++)A+=D>d?J.getDistance(N[d][0],N[d][1]):J.getDistance(N[d][0],V);return A}}},V.calculateClosestPoint=function(r,B){var q=this,D=q.getDataUI(r),c=ph(D),Y=[];if(c){for(var o=c.length,J=0;o>J;J++){var F=c[J];F._as&&(F=F._as);for(var k=F[0],l=1;l<F.length;l++)Y.push([k,F[l]]),k=F[l]}for(var e=[],J=0;J<Y.length;J++){var N=gb(Y[J][0],Y[J][1],B);e.push(N)}return e.sort(function(n,W){return n.z>W.z?1:n.z<W.z?-1:0}),e[0]}},J.calculateClosestPoint=function(H,s,D){var Q=ph(u,H,s),s=[];if(Q){for(var G=Q.length,v=0;G>v;v++){var z=Q[v];z._as&&(z=z._as);for(var e=z[0],k=1;k<z.length;k++)s.push([e,z[k]]),e=z[k]}for(var R=[],v=0;v<s.length;v++){var b=gb(s[v][0],s[v][1],D);R.push(b)}return R.sort(function(q,f){return q.z>f.z?1:q.z<f.z?-1:0}),R[0]}},V.getPercentAngle=function(c,Q){var l=this,v=l.getDataUI(c),Z=c.getRotation?c.getRotation():0,u=ph(v);if(u)if(0===Q){var K=u[0][0],r=u[0][1];Z+=C(r.y-K.y,r.x-K.x)}else if(100===Q){u=u[u.length-1];var K=u[u.length-2],r=u[u.length-1];Z+=C(r.y-K.y,r.x-K.x)}else{for(var S=0,t=[],b=u.length,I=0;b>I;I++){var $=u[I],m=Oc($);S+=m,t.push(m)}for(var O=S*Q/100,J=fl(O,t),W=0,Y=0;J>Y;Y++)W+=t[Y];O-=W;for(var w=oi(u[J],O),h=u[J],e=0,G=0,A=0;A<h.length-1;A++){var B=h[A],d=h[A+1],N=d.x-B.x,V=d.y-B.y,q=n(N*N+V*V);if(e+=q,e>O){G=A;break}}var E=h[G];Z+=C(w.y-E.y,w.x-E.x)}return Z},J.getPercentAngle=function(v,I,K){var j=0,r=ph(u,v,I);if(r)if(0===K){var B=r[0][0],y=r[0][1];j+=C(y.y-B.y,y.x-B.x)}else if(100===K){r=r[r.length-1];var B=r[r.length-2],y=r[r.length-1];j+=C(y.y-B.y,y.x-B.x)}else{for(var N=0,W=[],U=r.length,x=0;U>x;x++){var e=r[x],s=Oc(e);N+=s,W.push(s)}for(var V=N*K/100,T=fl(V,W),l=0,g=0;T>g;g++)l+=W[g];V-=l;for(var H=oi(r[T],V),R=r[T],Q=0,o=0,Y=0;Y<R.length-1;Y++){var p=R[Y],i=R[Y+1],q=i.x-p.x,L=i.y-p.y,w=n(q*q+L*L);if(Q+=w,Q>V){o=Y;break}}var Z=R[o];j+=C(H.y-Z.y,H.x-Z.x)}return j},V.calculateLength=function(x){var u=this,w=u.getDataUI(x),X=ph(w),t=0;if(X)if(Array.isArray(X[0]))for(var r=X.length,S=0;r>S;S++){var h=X[S],L=Oc(h);t+=L}else t=Oc(X);return t},J.calculateLength=function(H,j){var H=ph(u,H,j),C=0;if(H)if(Array.isArray(H[0]))for(var c=H.length,G=0;c>G;G++){var Z=H[G],B=Oc(Z);C+=B}else C=Oc(H);return C};var gb=J.calculateClosestPointOnLine=function(G,Y,M){var q=G.x,C=G.y,p=Y.x,I=Y.y,o=M.x,D=M.y,B={},j=p-q,x=I-C,N=Math.sqrt(j*j+x*x),h=j/N,y=x/N,A=(-q+o)*h+(-C+D)*y;return B.x=q+A*h,B.y=C+A*y,Ag(B,G,Y)||(B.x=Math.abs(B.x-G.x)<Math.abs(B.x-Y.x)?G.x:Y.x,B.y=Math.abs(B.y-G.y)<Math.abs(B.y-Y.y)?G.y:Y.y),j=o-B.x,x=D-B.y,B.z=Math.sqrt(j*j+x*x),B},Ag=function(u,s,W){return u.x>=Math.min(s.x,W.x)&&u.x<=Math.max(s.x,W.x)&&u.y>=Math.min(s.y,W.y)&&u.y<=Math.max(s.y,W.y)},Oc=function(J){for(var G=0,D=J.length-1,R=0;D>R;R++){var A=J[R],x=J[R+1],H=x.x-A.x,j=x.y-A.y,T=n(H*H+j*j);G+=T}return G},oi=function(r,T){for(var v=0,q=0,N=0,s=r.length-1,u=0;s>u;u++){var d=r[u],U=r[u+1],j=U.x-d.x,i=U.y-d.y;if(N=n(j*j+i*i),v+=N,v>T){v-=N,q=u;break}}var S=r[q],k=r[q+1],f=C(k.y-S.y,k.x-S.x),F=T-v,i=y(f)*F,j=h(f)*F;return{x:S.x+j,y:S.y+i}},mj=function(r,f,z,P){var _=h(P),j=y(P),O=_*f-j*z,Q=j*f+_*z;return r?{x:r.x+O,y:r.y+Q}:{x:O,y:Q}},Gb=function(d,S){d[M]=d[K]=d[s]=S[Y]=u},Dg=function(U,q,f,n,u,N){var k,E,C,d,e,A,S,j,m,W,P,b=[];if(v(n)>_&&(n=_),e=T(v(n)/(B/4)),k=n/e,E=-k,C=-f,e>0){A=U+h(f)*u,S=q+y(-f)*N,b.push({x:A,y:S});for(var D=0;e>D;D++)C+=E,d=C-E/2,j=U+h(C)*u,m=q+y(C)*N,W=U+h(d)*(u/h(E/2)),P=q+y(d)*(N/h(E/2)),b.push({x:W,y:P}),b.push({x:j,y:m})}return b},ph=function(E,x,y){if(x==u){var n=E._data;if(n instanceof a){if(x=n.getPoints(),y=n.getSegments(),(!y||0===y.size())&&x){y=new b.List([1]);for(var k=1;k<x.size();k++)y.add(2)}}else if(n instanceof O){var v=E._78o;if(v){var m=v.type,f=v.points,I=v.segments,Y=v._4O;if(!m||f){var q=v.sourcePoint,g=q.x,J=q.y,M=v.targetPoint,U=M.x,s=M.y;if(m)I?(x=new Q({x:g,y:J}),x.addAll(f),x.add({x:U,y:s}),y=new Q(I._as)):(x=new Q({x:g,y:J}),y=new Q([1]),f.each(function(N){x.add(N),y.add(2)}),x.add({x:U,y:s}),y.add(2));else if(v.looped){x=new Q(Dg(g,J,0,_,v.radius,v.radius)),y=new Q([1]);for(var k=0;k<(x.size()-1)/2;k++)y.add(3)}else x=new Q,v.center?(x.add({x:v.c1.x,y:v.c1.y}),x.add({x:g,y:J}),x.add({x:U,y:s}),x.add({x:v.c2.x,y:v.c2.y}),y=new Q([1,2,2,2])):(x.add({x:g,y:J}),x.add({x:U,y:s}),y=new Q([1,2]))}else if(Y)if(x=new Q(Y.points._as),Y.segments)y=new Q(Y.segments._as);else{y=new Q([1]);for(var k=1;k<Y.points.size();k++)y.add(2)}}}}if(x){if(Array.isArray(x)&&(x=new Q(x)),"number"==typeof x.get(0)){for(var T=new b.List,k=0;k<x.size();k+=2)T.add({x:x.get(k),y:x.get(k+1)});x=T}if(!y){y=[];for(var k=0;k<x.size();k++)0===k?y.push(1):y.push(2)}Array.isArray(y)&&(y=new Q(y));for(var R=$.toPointsArray(x._as,y._as,50),H=R.length,o=[],k=0;H>k;k++){var e=R[k];e.length>1&&o.push(e)}return o}},Ur=function(H){var n=H._data,w=ph(H);if(w){n.s("flow.reverse")&&(w.reverse(),w.forEach(function(M){M.reverse()}));for(var h=0,e=[],t=w.length,A=0;t>A;A++){var $=w[A],i=Oc($);h+=i,e.push(i)}if(n[M]=e,n[K]=h,n[s]=w,n instanceof O){var g=J.unionPoint(w),q=g.x+g.width/2,d=g.y+g.height/2;n.$10e={x:q,y:d}}wm(H,!0)}},wm=(J.getPercentPositionOnPoints=function(C,g,c){if(C){var j=ph(u,C,g);if(j){var k;if(0===c)k=j[0][0];else if(100===c)j=j[j.length-1],k=j[j.length-1];else{for(var e=0,T=[],W=j.length,h=0;W>h;h++){var K=j[h],I=Oc(K);e+=I,T.push(I)}for(var N=e*c/100,Y=fl(N,T),H=0,d=0;Y>d;d++)H+=T[d];N-=H,k=oi(j[Y],N)}return k}}},V.getPercentPosition=function(W,V){var X=this,M=X.getDataUI(W),E=ph(M);if(E){var l;if(0===V)l=E[0][0];else if(100===V)E=E[E.length-1],l=E[E.length-1];else{for(var A=0,b=[],Z=E.length,q=0;Z>q;q++){var H=E[q],D=Oc(H);A+=D,b.push(D)}for(var S=A*V/100,L=fl(S,b),a=0,s=0;L>s;s++)a+=b[s];S-=a,l=oi(E[L],S)}return l}},function(s,c){var N=s._data,l=N[K],I=N.s(p),V=N.s(f),A=0,x=N[M],n=N.s(i),v=N.s(E),o=N.s(X),j=(n-v)/(o-1),T=[];if(x){if(1===o)T.push(n);else if(2===o)T.push(n),T.push(v);else{if(!(o>2))return;T.push(n);for(var F=o-2;F>0;F--)T.push(v+j*F);T.push(v)}var q=0,d=0;T.forEach(function(T){o-1>q&&(d+=N.getFlowElementSpace(T)),q++}),d+=(n+v)/2,A=(l-I*d+d)/I;var z=s[Y];for(null==z&&(z=0),c||(z+=V);z>l+d;){var w=s._overCount;w?w++:w=1,w>=I&&(w=null),s._overCount=w,N.s("flow.autoreverse")?w?z-=A+d:(z=0,N.s("flow.reverse",!N.s("flow.reverse"))):z-=A+d}s[Y]=z}}),Yi=function(Y){var K=Y.data,R=this.dm();if(K&&"add"===Y.kind){var M=R.$3e;M&&K.s(H)&&M.indexOf(K)<0&&M.push(K)}"clear"===Y.kind&&(R.$3e=[])},ir=function(J){var i=J.property,_=J.data,X=J.newValue,M=this.dm().$3e;if(M&&"s:flow"===i)if(X)M.indexOf(_)<0&&M.push(_);else for(var r=M.length,Z=0;r>Z;Z++)if(M[Z]===_){M.splice(Z,1);break}},fl=fl=function(P,c){for(var m=0,R=c.length,i=0;R>i;i++){var V=c[i];if(m+=V,m>P)return i}return Math.min(i,R-1)},ch=function(v){var H=this,l=H._data,B=l[K],g=l[M],D=l[s],L=l.s(p),Q=0,G=H[Y],N=l.s(i),A=l.s(E),q=l.s(X),m=l.s(c),t=l.s(d),a=l.s(F),r=(t-m)/(q-1),y=(N-A)/(q-1),W=l.getRotation?l.getRotation():0,O=l.getPosition?l.p():l.$10e,w=[],o=[];if(G!=u){if(1===q)w.push(N);else if(2===q)w.push(N),w.push(A);else{if(!(q>2))return;w.push(N);for(var x=q-2;x>0;x--)w.push(A+y*x);w.push(A)}if(1===q)o.push(t);else if(2===q)o.push(t),o.push(m);else{if(!(q>2))return;o.push(t);for(var x=q-2;x>0;x--)o.push(m+r*x);o.push(m)}var U=0,T=0;w.forEach(function(f){q-1>U&&(T+=l.getFlowElementSpace(f)),U++}),T+=(N+A)/2,Q=(B-L*T+T)/L,v.save();for(var x=0;L>x;x++){var $=G,_=0,j=H._overCount,J=0;l.s("flow.autoreverse")&&j&&j>L-(x+1)||($-=x*(Q+T),U=0,w.forEach(function(y){var k=$-_;if(k>=0&&B>k){var e=!0,N=fl(k,g);J=0;for(var t=0;N>t;t++)J+=g[t];if(k-=J,e){var q=oi(D[N],k),m=W;if(a){for(var x=D[N],Y=0,V=0,L=0;L<x.length-1;L++){var j=x[L],f=x[L+1],c=f.x-j.x,u=f.y-j.y,I=n(c*c+u*u);if(Y+=I,Y>k){V=L;break}}var p=x[V];m+=C(q.y-p.y,q.x-p.x)}W&&(q=mj(O,q.x-O.x,q.y-O.y,W)),H.$5e(v,q,y,o[U],m)}}_+=l.getFlowElementSpace(w[U]),U++}))}v.restore()}},Ti=function(){var F=this,f=F._data,q=f.s(i),V=!1,_=u;if(F._6I||(V=!0),_=f instanceof O?w.call(F):e.call(F),f.s(H)&&V){var C=f.s(d),D=f.s(G);D&&C>q&&(q=C),q>0&&J.grow(_,T(q/2)),Ur(F)}return!f.s(H)&&V&&Gb(f,F),_};o.getFlowElementSpace=function(){return this.s(R)},W._79o=Ti,x._79o=Ti,l[i]==u&&(l[i]=7),l[E]==u&&(l[E]=0),l[p]==u&&(l[p]=1),l[f]==u&&(l[f]=3),l[X]==u&&(l[X]=10),l[R]==u&&(l[R]=3.5),l[F]==u&&(l[F]=!1),l[r]==u&&(l[r]="rgba(255, 255, 114, 0.4)"),l[t]==u&&(l[t]="rgba(255, 255, 0, 0.3)"),l[U]==u&&(l[U]="rgba(255, 255, 0, 0)"),l[G]==u&&(l[G]=1),l[d]==u&&(l[d]=22),l[c]==u&&(l[c]=4),j.prepareRemove=function($){A.call(this,$);var c=$._dataModel,s=c.$3e;if(s)for(var _=s.length,h=0;_>h;h++)if(s[h]===$){s.splice(h,1);break}},V.setDataModel=function(S){var Z=this,q=Z._dataModel;if(q!==S){q&&(q.umm(Yi,Z),q.umd(ir,Z),q.$3e=[]),S.mm(Yi,Z),S.md(ir,Z);var Y=S.$3e=[];S.each(function(c){c.s(H)&&Y.indexOf(c)<0&&Y.push(c)}),qr.call(Z,S)}},V.setFlowInterval=function(l){var U=this,N=U.$11e;U.$11e=l,U.fp("flowInterval",N,l),U.$7e!=u&&(clearInterval(U.$7e),delete U.$7e,U.enableFlow(l))},V.getFlowInterval=function(){return this.$11e},V.$9e=function(){var H,A,t,w=this,a=w.tx(),Z=w.ty(),P=w.getZoom(),X=w.getWidth(),V=w.getHeight(),i={x:-a/P,y:-Z/P,width:X/P,height:V/P},d=w.dm().$3e,k=w._56I,F=new Q;if(d.forEach(function(W){k[W.getId()]&&(H=w.getDataUI(W),H&&(t=H._79o(),t&&F.add(t)))}),0!==F.size()&&(F.each(function(e){J.intersectsRect(i,e)&&(A=J.unionRect(A,e))}),A&&(A&&(J.grow(A,L(1,1/P)),A.x=S(A.x*P)/P,A.y=S(A.y*P)/P,A.width=T(A.width*P)/P,A.height=T(A.height*P)/P,A=J.intersection(i,A)),A))){var r=w._canvas.getContext("2d");r.save(),r.lineCap=J.lineCap,r.lineJoin=J.lineJoin,$.translateAndScale(r,a,Z,P),r.beginPath(),r.rect(A.x,A.y,A.width,A.height),r.clip(),r.clearRect(A.x,A.y,A.width,A.height),w.$6e(r,A),r.restore()}},V.$6e=function(S,R){var N,o,Y=this;Y._93db(S),Y.each(function(Q){Y._56I[Q._id]&&(N=Y.getDataUI(Q),N&&(o=N._79o(),(!R||J.intersectsRect(R,o))&&N._42(S)))}),Y._92db(S)},V.enableFlow=function(X){var S=this,m=S.dm(),$=m.$3e;S.$7e==u&&($.forEach(function(W){var U=S.getDataUI(W);Ur(U)}),S.$7e=setInterval(function(){m.$3e.forEach(function(L){wm(S.getDataUI(L))}),S.$9e()},X||S.$11e||50))},V.disableFlow=function(){var K=this;clearInterval(K.$7e),delete K.$7e;var f=K.dm().$3e;f&&K.$9e()},N.$5e=function(j,L,Q,g,S){var E=this,N=E._data,x=E.gv,l=N.s(r),W=N.s(t),p=N.s(U),V=N.s(G),d=x.$8e,h=N.s(Z);if(d==u&&(d=x.$8e={}),j.beginPath(),h!=u){var k=J.getImage(h),K=Q/2;j.translate(L.x,L.y),j.rotate(S),j.translate(-L.x,-L.y),J.drawImage(j,k,L.x-K,L.y-K,Q,Q,N),j.translate(L.x,L.y),j.rotate(-S),j.translate(-L.x,-L.y)}else j.fillStyle=l,j.arc(L.x,L.y,Q/2,0,_,!0),j.fill();if(V){var X=22,q=X+"_"+W+"_"+p,M=d[q];if(M==u){var R=So("canvas");$.setCanvas(R,X,X);var n=R.getContext("2d"),P=X/2,m=P,v=P;$.translateAndScale(n,0,0,1),n.beginPath();var O=n.createRadialGradient(m,v,0,m,m,P);O.addColorStop(0,W),O.addColorStop(1,p),n.fillStyle=O,n.arc(m,v,P,0,_,!0),n.fill(),M=d[q]=R}var K=g/2;J.drawImage(j,M,L.x-K,L.y-K,g,g,N)}},x._80o=function(s){z.call(this,s);var F=this,G=F._data,v=F.gv;G.s(H)&&v.$7e!=u&&ch.call(F,s)},W._80o=function(t){P.call(this,t);var V=this,C=V._data,y=V.gv;C.s(H)&&y.$7e!=u&&ch.call(V,t)}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);